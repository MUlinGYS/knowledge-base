<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Spring笔记</title>
	<link rel="stylesheet" href="css/general.css" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>

<body>
	<div class="head fix" style="background-color: #11B5AE;">
		<div class="tt">
			<div class="t2">Vue</div>
			<div class="t3">一个渐进式JavaScript 框架</div>
		</div>
	</div>
	<div class="content">
		<!-- 卡片将在这里插入 -->
	</div>

</body>
<!-- 基于canvas绘制的网页背景效果 -->
<script type="text/javascript" src="https://cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>
<script type="text/javascript" src="./js/jquery.js"></script>
<script>

	// window.onload = function () {
	// 	adjustCardDisplay();
	// 	console.log('方法调用');
	// 	// window.addEventListener('resize', adjustCardDisplay);
	// };

	document.addEventListener("DOMContentLoaded", function () {
		adjustCardDisplay();
		// 动态的分配卡片的数量
		// 每当窗口的大小改变时，就会触发 resize 事件，然后执行 adjustCardDisplay 函数，重新调整卡片的布局。
		window.addEventListener('resize', adjustCardDisplay);
	});
	// 调整卡片显示以适应窗口大小
	function adjustCardDisplay() {
		// 清除所有现有的容器，避免窗口变化时有旧容器残留
		document.querySelectorAll('.container').forEach(function (el) {
			el.remove();
		});

		var windowWidth = window.innerWidth;
		var cardWidth = 250; // 卡片宽度
		var margin = 20; // 卡片间的间距
		var cardsPerRow = Math.floor(windowWidth / (cardWidth + margin));

		$.ajax({
			url: "http://localhost:3000/essay",
			type: "GET",
			dataType: "json",
			success: function (result) {
				var rowIndex = 0;
				var container;
				result.data.essays.forEach(function (essay, index) {
					if (index % cardsPerRow === 0) {
						rowIndex++;
						container = document.getElementById('card-container-' + rowIndex);
						if (!container) {
							container = document.createElement('div');
							container.id = 'card-container-' + rowIndex;
							container.className = 'container';
							container.style = 'display: flex;justify-content: space-evenly;width: 100%;max-width: 100%;margin: 20px 0;';
							document.body.appendChild(container);
						}

						// 清除容器中的现有内容
						container.innerHTML = '';
					}

					var card = '<div class="card" style="width: 300px;margin:0 10px;">' +
						'<img class="card-img-top" src="./img/login.gif" alt="Card image">' +
						'<div class="card-body">' +
						'<h4 class="card-title">' + essay.essaysTitle + '</h4>' +
						'<p class="card-text">' + essay.detail + '</p>' +
						'<a href="#" class="btn btn-primary">查看文章</a>' +
						'</div></div>';

					container.innerHTML += card;
				});

				var remainingCards = cardsPerRow - (result.data.essays.length % cardsPerRow);
				if (remainingCards < cardsPerRow) {
					for (var i = 0; i < remainingCards; i++) {
						var placeholder = '<div class="card placeholder" style="width: 300px;margin:0 10px;"></div>';
						container.innerHTML += placeholder;
					}

				}

				parent.adjustIframeHeight(document.body.scrollHeight);
				console.log(document.body.scrollHeight);

			},
			error: function () {
				var container = document.getElementById('card-container-one');
				// 当请求失败时，清除所有的容器
				document.querySelectorAll('.container').forEach(function (container) {
					container.innerHTML = '';
				});
				var errorCard = '<div class="card" style="width: 300px;margin:0 10px;">' +
					'<div class="card-body">' +
					'<h4 class="card-title">网络错误</h4>' +
					'<p class="card-text">请检查你的网络连接并刷新页面。</p>' +
					'</div></div>';
				container.innerHTML = errorCard;

				parent.adjustIframeHeight(document.body.scrollHeight);
				console.log(document.body.scrollHeight);
			}
		});
	}

</script>

<style>
	/* 占位作用 */
	.placeholder {
		visibility: hidden;
	}
</style>

</html>